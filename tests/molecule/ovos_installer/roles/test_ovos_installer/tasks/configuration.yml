---
- name: Block containers configuration
  when: test_ovos_installer_method == "containers"
  block:
    - name: Register container config directory status
      ansible.builtin.stat:
        path: "{{ test_ovos_installer_user_home }}/ovos/config"
      register: test_ovos_installer_config_dir

    - name: Assert container config directory is created
      ansible.builtin.assert:
        that:
          - test_ovos_installer_config_dir.stat.exists
          - test_ovos_installer_config_dir.stat.isdir
          - test_ovos_installer_config_dir.stat.pw_name == test_ovos_installer_user
          - test_ovos_installer_config_dir.stat.gr_name == test_ovos_installer_user
          - test_ovos_installer_config_dir.stat.mode == '0755'

    - name: Register container mycroft.conf status
      ansible.builtin.stat:
        path: "{{ test_ovos_installer_user_home }}/ovos/config/mycroft.conf"
      register: test_ovos_installer_config_file

    - name: Assert container mycroft.conf is created
      ansible.builtin.assert:
        that:
          - test_ovos_installer_config_file.stat.exists
          - not test_ovos_installer_config_file.stat.isdir
          - test_ovos_installer_config_file.stat.pw_name == test_ovos_installer_user
          - test_ovos_installer_config_file.stat.gr_name == test_ovos_installer_user
          - test_ovos_installer_config_file.stat.mode == '0600'

- name: Block virtualenv configuration
  when: test_ovos_installer_method == "virtualenv"
  block:
    - name: Register virtualenv mycroft config directory status
      ansible.builtin.stat:
        path: "{{ test_ovos_installer_user_home }}/.config/mycroft"
      register: test_ovos_installer_config_dir

    - name: Assert virtualenv mycroft config directory is created
      ansible.builtin.assert:
        that:
          - test_ovos_installer_config_dir.stat.exists
          - test_ovos_installer_config_dir.stat.isdir
          - test_ovos_installer_config_dir.stat.pw_name == test_ovos_installer_user
          - test_ovos_installer_config_dir.stat.gr_name == test_ovos_installer_user
          - test_ovos_installer_config_dir.stat.mode == '0755'

    - name: Register virtualenv mycroft.conf status
      ansible.builtin.stat:
        path: "{{ test_ovos_installer_user_home }}/.config/mycroft/mycroft.conf"
      register: test_ovos_installer_config_file

    - name: Assert virtualenv mycroft.conf is created
      ansible.builtin.assert:
        that:
          - test_ovos_installer_config_file.stat.exists
          - not test_ovos_installer_config_file.stat.isdir
          - test_ovos_installer_config_file.stat.pw_name == test_ovos_installer_user
          - test_ovos_installer_config_file.stat.gr_name == test_ovos_installer_user
          - test_ovos_installer_config_file.stat.mode == '0600'
