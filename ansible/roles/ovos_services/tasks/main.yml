---
- name: Include assert.yml
  ansible.builtin.import_tasks: assert.yml
  tags:
    - always

- name: Ensure OVOS runtime user directories exist with correct ownership
  ansible.builtin.file:
    path: "{{ item }}"
    state: directory
    owner: "{{ ovos_installer_user }}"
    group: "{{ ovos_installer_group }}"
    mode: "0755"
    recurse: true
  loop: "{{ ovos_services_user_runtime_dirs }}"
  when:
    - ovos_installer_method == "virtualenv"
    - not (ovos_installer_cleaning | default(false) | bool)

- name: Include systemd backend tasks
  ansible.builtin.import_tasks: systemd.yml
  when:
    - ansible_facts.system == 'Linux'
    - ovos_services_manager == 'systemd'
    - ovos_installer_method == "virtualenv" or ovos_installer_cleaning | default(false) | bool

- name: Include launchd backend tasks
  ansible.builtin.import_tasks: launchd.yml
  when:
    - ansible_facts.system == 'Darwin'
    - ovos_services_manager == 'launchd'
    - ovos_installer_method == "virtualenv" or ovos_installer_cleaning | default(false) | bool
