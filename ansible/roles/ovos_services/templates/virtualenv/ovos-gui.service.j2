[Unit]
Documentation=https://openvoiceos.github.io/ovos-docker/about/glossary/components/#ovos-shell
Description=Open Voice OS - GUI
PartOf=ovos.service
Requires=ovos.service ovos-gui-websocket.service ovos-phal.service
After=ovos.service ovos-gui-websocket.service ovos-phal.service

[Service]
{% set _ovos_headless_display = (ovos_installer_display_server | default('') | lower) in ['n/a', 'eglfs'] %}
{% if (ovos_installer_systemd_scope | default('user')) == 'system' %}
User={{ ovos_installer_user }}
Group={{ ovos_installer_group }}
Environment=HOME={{ ovos_installer_user_home }}
Environment=XDG_RUNTIME_DIR=/run/user/{{ ovos_installer_uid }}
Environment=DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/{{ ovos_installer_uid }}/bus
EnvironmentFile=-{{ ovos_installer_user_home }}/.config/environment.d/99-ovos-tuning.conf
{% endif %}
{% if not _ovos_headless_display %}
Environment=DISPLAY={{ ovos_installer_display_server_number | default(':0') }}
Environment=WAYLAND_DISPLAY={{ ovos_installer_wayland_display | default('wayland-0') }}
{% endif %}
Environment="QT_QPA_PLATFORM={{ 'eglfs' if _ovos_headless_display else 'wayland;xcb' }}"
Environment="QT_QPA_PLATFORMTHEME=qt5ct"
Environment="QT_QPA_EGLFS_KMS_ATOMIC=1"
Environment="QT_FONT_DPI=120"
Environment="QT_QUICK_CONTROLS_STYLE=OpenVoiceStyle"
Environment="QT_FILE_SELECTORS=ovos"
Environment="QT_QPA_EGLFS_HIDECURSOR=1"
{% if 'tas5806' in ovos_installer_i2c_devices %}
Environment="QT_IM_MODULE=qtvirtualkeyboard"
{% endif %}
ExecStart=/usr/bin/{{ 'ovos-shell' if _ovos_headless_display else 'ovos-gui-app' }}
ExecReload=/usr/bin/kill -s HUP $MAINPID
ExecStop=/usr/bin/kill -s KILL $MAINPID
Restart=on-failure
RestartSec={{ '1s' if ovos_installer_tuning | bool else '5s' }}

[Install]
WantedBy=ovos.service
